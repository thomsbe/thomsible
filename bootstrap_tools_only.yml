---
# Vereinfachtes Bootstrap Playbook - nur Tools installieren
# Dieses Playbook installiert nur die GitHub-Tools und Konfiguration
# ohne einen separaten Ansible-Benutzer zu erstellen.
#
# Verwendung:
#   ansible-playbook bootstrap_tools_only.yml
#   ansible-playbook bootstrap_tools_only.yml -e "target_user=thomas"

- name: "Install modern CLI tools locally"
  hosts: localhost
  connection: local
  become: true
  gather_facts: true

  vars:
    # Ziel-Benutzer (Standard: echter Benutzer, nicht sudo-Benutzer)
    target_user: "{{ ansible_env.SUDO_USER | default(ansible_user_id) }}"

    # Minimale Tool-Auswahl für schnelle Installation
    github_tools_to_install:
      - lazygit      # Git Terminal UI
      - starship     # Modern prompt
      - btop         # System monitor
      - fzf          # Fuzzy finder
      - bat          # Better cat
      - eza          # Better ls
      - ripgrep      # Better grep
      - fd           # Better find

    # Aliases für bessere UX
    github_tools_create_aliases: true

    # Konflikt-Erkennung
    github_tools_check_conflicts: true

  pre_tasks:
    - name: "Display installation info"
      ansible.builtin.debug:
        msg: |
          🛠️  MODERN CLI TOOLS INSTALLATION 🛠️

          Target user: {{ target_user }}
          Tools to install: {{ github_tools_to_install | join(', ') }}
          Installation path: ~/.local/bin

          This is a lightweight installation that only installs
          modern CLI tools without creating additional users.

    - name: "Get target user information"
      ansible.builtin.getent:
        database: passwd
        key: "{{ target_user }}"
      register: target_user_info

    - name: "Set target user home directory"
      ansible.builtin.set_fact:
        target_user_home: "{{ target_user_info.ansible_facts.getent_passwd[target_user][4] }}"

  roles:
    - role: user_config
    - role: git
    - role: github_tools

  post_tasks:
    - name: "Installation completed"
      ansible.builtin.debug:
        msg: |
          ✅ MODERN CLI TOOLS INSTALLED! ✅

          📦 Installed tools:
          {% for tool in github_tools_to_install %}
          - {{ tool }}: {{ target_user_home }}/.local/bin/{{ tool }}
          {% endfor %}

          🐚 Shell configuration:
          - Fish shell configured with PATH
          - Bash profile updated with PATH
          {% if github_tools_create_aliases %}
          - Aliases: bat→cat, eza→ls
          {% endif %}

          🎨 Starship prompt configured with custom theme

          🚀 Quick start:
          1. Restart your shell or run: source ~/.bashrc
          2. Try: lazygit, btop, fzf, bat README.md
          3. Use Ctrl+R for fuzzy history search (fzf)

          💡 All tools are in ~/.local/bin and added to your PATH!
