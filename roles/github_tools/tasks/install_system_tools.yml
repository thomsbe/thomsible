---
# Install system tools that are not available from GitHub releases
# These tools are installed via package managers

- name: "Install system tools on Debian/Ubuntu"
  ansible.builtin.apt:
    name:
      - ncdu          # Interactive disk usage
      - lshw          # Hardware information
      - mtr           # Network tracing (traceroute + ping)
      - glances       # System monitoring
      - dstat         # System statistics
      - magic-wormhole # Secure file transfer
      - unp           # Universal unpacker
    state: present
    update_cache: yes
  when: ansible_os_family == "Debian"

- name: "Install system tools on RedHat/Fedora"
  ansible.builtin.dnf:
    name:
      - ncdu          # Interactive disk usage
      - lshw          # Hardware information
      - mtr           # Network tracing (traceroute + ping)
      - glances       # System monitoring
      - dstat         # System statistics
      - magic-wormhole # Secure file transfer
      - unp           # Universal unpacker
    state: present
  when: ansible_os_family == "RedHat"

- name: "Verify system tools installation"
  ansible.builtin.shell: |
    echo "=== System Tools Verification ==="

    # Test each tool
    tools=(ncdu lshw mtr glances dstat wormhole unp)
    for tool in "${tools[@]}"; do
      if command -v $tool >/dev/null 2>&1; then
        case $tool in
          ncdu) echo "✅ ncdu: $(ncdu --version 2>/dev/null | head -1 || echo 'Interactive disk usage')" ;;
          lshw) echo "✅ lshw: $(lshw -version 2>/dev/null | head -1 || echo 'Hardware information')" ;;
          mtr) echo "✅ mtr: $(mtr --version 2>/dev/null | head -1 || echo 'Network tracing')" ;;
          glances) echo "✅ glances: $(glances --version 2>/dev/null | head -1 || echo 'System monitoring')" ;;
          dstat) echo "✅ dstat: $(dstat --version 2>/dev/null | head -1 || echo 'System statistics')" ;;
          wormhole) echo "✅ magic-wormhole: $(wormhole --version 2>/dev/null | head -1 || echo 'Secure file transfer')" ;;
          unp) echo "✅ unp: $(unp --version 2>/dev/null | head -1 || echo 'Universal unpacker')" ;;
        esac
      else
        echo "❌ $tool: Not found or not installed"
      fi
    done

    echo ""
    echo "📊 System Tools Summary:"
    installed_count=$(for tool in ncdu lshw mtr glances dstat wormhole unp; do command -v $tool >/dev/null 2>&1 && echo 1; done | wc -l)
    echo "Installed: $installed_count/7 system tools"

    echo ""
    echo "💡 Usage examples:"
    echo "- ncdu /home - Interactive disk usage"
    echo "- lshw -short - Hardware overview"
    echo "- mtr google.com - Network tracing"
    echo "- glances - System monitoring"
    echo "- dstat - Live system stats"
    echo "- wormhole send file.txt - Send file"
    echo "- unp archive.zip - Extract any archive"

    echo "=== System Tools Verification Complete ==="
  register: system_tools_verification
  changed_when: false

- name: "Display system tools verification results"
  ansible.builtin.debug:
    var: system_tools_verification.stdout_lines
